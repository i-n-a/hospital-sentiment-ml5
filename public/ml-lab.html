<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ğŸ”¬ ML Lab - Neural Network Training</title>
  <link rel="stylesheet" href="./css/style.css">
  <script src="https://unpkg.com/ml5@1/dist/ml5.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.4/p5.min.js"></script>
</head>
<body>
  <header class="app-header">
    <nav class="nav-main">
      <a href="./index.html" class="nav-link nav-marketing">ğŸ“Š Marketing Dashboard</a>
      <a href="./ml-lab.html" class="nav-link nav-lab active">ğŸ”¬ ML Lab</a>
    </nav>
  </header>

  <main class="app-main">
    <!-- 1. PROGRESS + CONTEXT (Slim header) -->
    <header class="ml-lab-header">
      <div class="header-left">
        <h1>ğŸ”¬ ML Lab</h1>
        <div class="status-badge" id="globalStatus">Loading...</div>
      </div>
      <div class="progress-strip">
        <div class="progress-step active" data-step="1">Data</div>
        <div class="progress-step" data-step="2">Model</div>
        <div class="progress-step" data-step="3">Train</div>
        <div class="progress-step" data-step="4">Ready</div>
      </div>
    </header>

    <div class="ml-lab-grid">
      <!-- DATA PROCESSOR (MISSING!) -->
      <section class="data-processor">
        <h3>ğŸ”„ Process New Dataset</h3>
        <button id="openDataModal" class="btn-secondary">Upload New Dataset</button>
      </section>
      <!-- MODEL CONTROLS (MISSING!) -->
      <section class="model-controls">
        <h3>ğŸ’¾ Model Management</h3>
        <div class="control-buttons">
          <button id="saveModelBtn" class="btn-primary">ğŸ’¾ Save Trained Model</button> 
          <button id="saveDataBtn" class="btn-secondary">ğŸ’¾ Save Trained Data in Json</button>
        </div>
      </section>
      <!-- 2. SENTIMENT SUMMARY (Slim card) -->
      <section class="sentiment-summary">
        <h3>ğŸ“Š Data Overview</h3>
        <div class="sentiment-bars-compact">
          <div class="sentiment-bar-compact negative">
            <span id="count-neg">0</span><span>Neg</span>
          </div>
          <div class="sentiment-bar-compact neutral">
            <span id="count-neu">0</span><span>Neu</span>
          </div>
          <div class="sentiment-bar-compact positive">
            <span id="count-pos">0</span><span>Pos</span>
          </div>
        </div>
        <div class="stats-line">
          <span id="total-examples">-</span> examples | 
          <span id="vocab-size">-</span> words
        </div>
      </section>


      <!-- 3. DATA EXPLORER (Collapsible below fold) -->
      <section class="data-explorer">
        <div class="section-toggle">
          <h3>ğŸ“‹ Training Data </h3>
          <span class="toggle-icon">-</span>
        </div>
        <div class="data-content open"> 
        <div class="data-header">
            <div class="data-controls">
          <select id="sentimentFilter">
            <option value="all">All Sentiments</option>
            <option value="negativo">Negative</option>
            <option value="neutro">Neutral</option>
            <option value="positivo">Positive</option>
          </select>
          <div class="pagination">
            <button id="prevPage" disabled>â† Prev</button>
            <span id="pageInfo">Page 1</span>
            <button id="nextPage" disabled>Next â†’</button>
          </div>
          </div>
        </div>
        <div id="data-list" class="data-grid"></div>
        </div>
      </section>

      <!-- 4. TEST PREDICTION (Hero section - ABOVE FOLD) -->
      <section class="prediction-hero">
        <h3>ğŸ§ª Test Prediction</h3>
        <textarea id="commentInput" rows="4" 
                  placeholder="Type a hospital comment to test the model... (e.g. 'PÃ©ssimo atendimento na urgÃªncia')"></textarea>
        <div class="prediction-controls">
          <button id="predictBtn" class="btn-primary" disabled>Predict Sentiment</button>
          <div class="confidence-meter" id="confidenceMeter"></div>
        </div>
        <div id="resultText" class="prediction-result"></div>
      </section>

      <!-- 5. TRAINING STATUS (Live feedback) -->
      <section class="training-live hidden">
        <h3>âš¡ Training Status</h3>
        <div id="modelStatus" class="status-message large">Initializing...</div>
        <div class="live-metrics">
          <div class="metric">
            <span class="metric-label">Epoch</span>
            <span id="currentEpoch">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Loss</span>
            <span id="currentLoss">-</span>
          </div>
          <div class="metric">
            <span class="metric-label">Status</span>
            <span id="trainingStatus">-</span>
          </div>
        </div>
      </section>


      <!-- 6. MODEL INSIGHTS (Learning curves + confusion matrix) -->
      <section class="model-insights">
        <h3>ğŸ“ˆ Model Learning</h3>
        <div id="ml-viz"></div>
        <div class="insight-metrics hidden">
          <div class="metric-card">
            <span class="metric-value" id="finalLoss">-</span>
            <span class="metric-label">Final Loss</span>
          </div>
          <div class="metric-card">
            <span class="metric-value" id="accuracy">-</span>
            <span class="metric-label">Test Accuracy</span>
          </div>
        </div>
      </section>
    </div>

    <!-- DATA PROCESSOR MODAL -->
    <div class="modal-overlay" id="dataModal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Process New Dataset</h3>
          <button class="modal-close" id="closeModal">Ã—</button>
        </div>
        
        <div class="processor-controls">
          <p>Please provide a csv file with first column sentiment and second column comentario to process and train a new model with ml5NeuralNetwork.</p>
          <input type="file" id="fileInput" accept=".txt,.csv">
          <label><input type="checkbox" id="removeShort" checked> Remove short tokens</label>
          <button id="processBtn" class="btn-primary" disabled>Process Data</button>
          <button id="downloadBtn" class="btn-secondary" disabled>Download JSON</button>
        </div>
        
        <div id="log" class="processor-log"></div>
        <div id="previewList" class="preview-list"></div>
        
        <button id="trainNewDatasetBtn" class="btn-primary full-width" disabled> Train New Model</button>
      </div>
    </div>

    <!-- ğŸ”¥ TRAINING LOADER MODAL -->
    <div class="training-overlay" id="trainingModal">
      <div class="training-content">
        <div class="training-header">
          <h3>Training Neural Network</h3>
        </div>
        <div class="training-progress">
          <div class="progress-container">
            <div class="progress-bar" id="trainingProgressBar"></div>
          </div>
          <div class="progress-text" id="trainingProgressText">0/320 Epochs</div>
        </div>
        <div class="training-status" id="trainingStatusText">Initializing model...</div>
      </div>
    </div>

  </main>

  <script type="module" src="js/ml5/data-processor.js"></script>
  <script type="module" src="js/ml5/text-utils.js"></script>
  <script type="module" src="js/ml5/model.js"></script>
  <script type="module" src="js/p5/sentiment-viz.js"></script>
  <script type="module" src="js/pages/ml-lab.js"></script>
</body>
</html>
